<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å–ø–æ–∑–Ω–∞—Ç—å</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@100..700&display=swap" rel="stylesheet">
</head>


<body>
        <header class="site-header">
        <div class="logo">
            <img src="qr-code.gif" alt="Logo">
        </div>
    </header>
    <main>
        <form id="dataForm">
            <textarea id="dataCodes" name="data_codes" rows="10" cols="50" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥—ã (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É) –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –æ—Ç –ë–ª–æ–∫–Ω–æ—Ç / Excel"></textarea><br>
            <div class="button-container">
                <input type="submit" value="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å">
                <input type="button" value="–û—á–∏—Å—Ç–∏—Ç—å" onclick="clearTextarea()">
            </div>
        </form>

        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
        <ol id="resultsList" class="gradient-list"></ol>
    </main>

    <script>
        document.getElementById('dataForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const dataCodes = document.getElementById('dataCodes').value.trim().split('\n');
            checkDataMatrix(dataCodes);
        });

        async function checkDataMatrix(dataCodes) {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

            for (let index = 0; index < dataCodes.length; index++) {
                const code = dataCodes[index];
                const baseUrl = "https://mobile.api.crpt.ru/mobile/check";
                const encodedCode = encodeURIComponent(code);
                const url = `${baseUrl}?code=${encodedCode}&codeType=datamatrix`;

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ');
                    }
                    const data = await response.json();
                    const infoMsg = [data.code || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥'];

                    if (data.codeFounded) {
                        const status = data.tiresData?.status || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å';
                        const statusMessages = {
                            'INTRODUCED': '–í –æ–±–æ—Ä–æ—Ç–µ ‚úÖ',
                            'RETIRED': '–í—ã–±—ã–ª –∏–∑ –æ–±–æ—Ä–æ—Ç–∞ ‚ùå',
                            'EMITTED': '–≠–º–∏—Ç–∏—Ä–æ–≤–∞–Ω, –≤—ã–ø—É—â–µ–Ω ‚úîÔ∏è',
                            'APPLIED': '–≠–º–∏—Ç–∏—Ä–æ–≤–∞–Ω, –ø–æ–ª—É—á–µ–Ω üîó',
                            'WRITTEN_OFF': '–ö–ò —Å–ø–∏—Å–∞–Ω üü•',
                            'DISAGGREGATION': '–†–∞—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω (—Ç–æ–ª—å–∫–æ –¥–ª—è —É–ø–∞–∫–æ–≤–æ–∫) üì¶üü•'
                        };
                        infoMsg.push(statusMessages[status] || `–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞ ‚ö†Ô∏è [${status}]`);
                        const productName = data.productName || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç';
                        infoMsg.push(`<b>[${productName}]</b>`);
                    } else {
                        infoMsg.push('–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚ùó');
                    }

                    const resultItem = document.createElement('li');
                    /*resultItem.innerHTML = `${index + 1}/${dataCodes.length}<br>${infoMsg.join('<br>')}`;*/
                    resultItem.innerHTML = `${infoMsg.join('<br>')}`;
                    resultsList.appendChild(resultItem);
                } catch (error) {
                    const resultItem = document.createElement('li');
                    resultItem.innerHTML = `${index + 1}/${dataCodes.length}<br>–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: ${error.message}`;
                    resultsList.appendChild(resultItem);
                }
            }
        }
    </script>

    <script src="js/dragDrop.js"></script>
    <script src="js/xlsx.full.min.js"></script>
</body>
</html>